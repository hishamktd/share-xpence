# Lefthook configuration
# Fast and powerful Git hooks manager
# https://github.com/evilmartians/lefthook

# Pre-commit hooks
pre-commit:
  parallel: true
  commands:
    # Lint and format staged files
    lint-staged:
      glob: "*.{js,ts,tsx,json,md,yml,yaml}"
      run: pnpm lint-staged
      stage_fixed: true

    # Type check TypeScript files
    typecheck:
      glob: "*.{ts,tsx}"
      run: pnpm typecheck
      skip:
        - merge
        - rebase

# Commit message hooks
commit-msg:
  commands:
    # Enforce conventional commits format
    commitlint:
      run: |
        if ! grep -qE "^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)(\(.+\))?: .{1,}" {1}; then
          echo "‚ùå Commit message must follow Conventional Commits format:"
          echo "   <type>(<scope>): <subject>"
          echo ""
          echo "Types: feat, fix, docs, style, refactor, perf, test, build, ci, chore, revert"
          echo ""
          echo "Example: feat(workspace): add new feature"
          exit 1
        fi

# Pre-push hooks
pre-push:
  commands:
    # Run tests before pushing
    test:
      run: pnpm test
      skip:
        - merge
        - rebase

    # Final lint check
    lint:
      run: pnpm lint

# Post-checkout hooks
post-checkout:
  commands:
    # Install dependencies if package.json changed
    install-deps:
      files: git diff-tree -r --name-only --no-commit-id HEAD@{1} HEAD
      glob: "{package.json,pnpm-lock.yaml}"
      run: pnpm install

# Post-merge hooks
post-merge:
  commands:
    # Install dependencies after merge
    install-deps:
      files: git diff-tree -r --name-only --no-commit-id ORIG_HEAD HEAD
      glob: "{package.json,pnpm-lock.yaml}"
      run: pnpm install
